// Generated by CoffeeScript 1.10.0
(function() {
  module.exports = function(grunt) {

    /* 开发目录与发布目录 */
    var bower, cssmin, destCss, destFonts, destHtml, destImg, destJs, dirs, js2Min, js2MinSync, js2Mult, js2MultSync, jsRequire, ref, ref1, ref2, ref3, ref4, ref5, ref6, scss, scssmin, srcCss, srcFonts, srcHtml, srcImg, srcImgMin;
    dirs = {
      destDir: 'dest',
      srcDir: 'src'
    };

    /* 发布目录文件夹 */
    ref = [dirs.destDir + '/html', dirs.destDir + '/js', dirs.destDir + '/css', dirs.destDir + '/img', dirs.destDir + '/fonts'], destHtml = ref[0], destJs = ref[1], destCss = ref[2], destImg = ref[3], destFonts = ref[4];

    /* 开发主页、图片、格式 */
    ref1 = [dirs.srcDir + '/html', dirs.srcDir + '/img', dirs.srcDir + '/imgMin', dirs.srcDir + '/fonts'], srcHtml = ref1[0], srcImg = ref1[1], srcImgMin = ref1[2], srcFonts = ref1[3];

    /* 开发CSS */
    ref2 = [dirs.srcDir + '/css', dirs.srcDir + '/cssmin'], srcCss = ref2[0], cssmin = ref2[1];

    /* 开发SCSS */
    ref3 = [dirs.srcDir + '/scss', dirs.srcDir + '/scssmin'], scss = ref3[0], scssmin = ref3[1];

    /* 一一按目录压缩JS */
    ref4 = [dirs.srcDir + '/bower', dirs.srcDir + '/jsRequire'], bower = ref4[0], jsRequire = ref4[1];

    /* 一一按目录压缩JS */
    ref5 = [dirs.srcDir + '/js2Min', dirs.srcDir + '/js2MinSync'], js2Min = ref5[0], js2MinSync = ref5[1];

    /* 多合一Js */
    ref6 = [dirs.srcDir + '/js2Mult', dirs.srcDir + '/js2MultSync'], js2Mult = ref6[0], js2MultSync = ref6[1];

    /* 任务配置 */
    grunt.config.init({
      pkg: grunt.file.readJSON('package.json'),

      /* 1.图片压缩到发布目录 */
      imagemin: {
        srcImg: {
          options: {
            optimizationLevel: 3
          },
          files: [
            {
              expand: true,
              cwd: srcImg,
              src: ['**/*.{png,jpg,jpeg,gif}'],
              dest: destImg
            }
          ]
        }
      },
      htmlmin: {
        html: {
          options: {
            removeComments: true,
            collapseWhitespace: true
          },
          files: [
            {
              expand: true,
              cwd: srcHtml,
              src: ['**/*.html'],
              dest: destHtml
            }
          ]
        }
      },

      /* 2.SCSS本地编译 */
      sass: {
        scss: {
          options: {
            style: 'expanded'
          },
          files: [
            {
              expand: true,
              cwd: scss,
              src: ['**/*.scss'],
              dest: scss,
              ext: '.css',
              flatten: false
            }
          ]
        }
      },

      /* 3.CSS格式检查 */
      csslint: {
        css: {
          options: {
            csslintrc: '.csslintrc.json'
          },
          checkCss: {
            options: {
              "import": 2
            },
            src: [scss + '*{,**/}*.css', srcCss + '{,**/}*.css']
          }
        }
      },

      /* 4.CSS本地压缩 */
      cssmin: {
        css: {
          files: [
            {
              expand: true,
              cwd: srcCss,
              src: ['**/*.css'],
              dest: cssmin,
              ext: '.css'
            }
          ]
        },
        scss: {
          files: [
            {
              expand: true,
              cwd: scss,
              src: ['**/*.css', '!**/*.map'],
              dest: scssmin,
              ext: '.css'
            }
          ]
        }
      },

      /* 5.单纯拼接合并CSS以及JS到发布目录，并没有压缩处理效果 */
      concat: {
        options: {
          separator: '/*****************!CONCAT*******************/',
          stripBanners: true,
          banner: '/*! <%= pkg.name %> - v<%= pkg.version %> - ' + '<%= grunt.template.today("yyyy-mm-dd") %> */\n'
        },
        cssCat: {
          src: [cssmin + '/**/*.css'],
          dest: destCss + '/srcAllCss.min.css'
        },
        scssCat: {
          src: [scssmin + '/**/*.css'],
          dest: destCss + '/srcAllScss.min.css'
        }
      },

      /* 6.js2Mult本地编译 */

      /* 注意src的斜杠格式 */
      coffee: {
        js2Min: {
          expand: true,
          flatten: false,
          cwd: js2Min,
          src: ['{,**/}*.coffee'],
          dest: js2Min,
          ext: '.js'
        },
        js2Mult: {
          expand: true,
          flatten: false,
          cwd: js2Mult,
          src: ['{,**/}*.coffee'],
          dest: js2Mult,
          ext: '.js'
        }
      },

      /* 7.JS检查 */
      jshint: {
        options: {
          jshintrc: '.jshintrc.json'
        },
        coffee2Js: [js2Min + '{,**/}*.js', js2Mult + '{,**/}*.js'],
        Gruntfile: ['Gruntfile.js']
      },

      /* 8.JS压缩 */
      uglify: {
        options: {
          banner: "/*! <%=pkg.name%>-<%=pkg.version%>.js 压缩于：<%= grunt.template.today('yyyy-mm-dd HH:MM') %> */\n",
          footer: '\n/*! <%= pkg.name %> 最后修改于： <%= grunt.template.today("yyyy-mm-dd") %> */',
          preserveComments: true
        },

        /* 按原目录下的每个文件结构压缩至新文件夹中 */
        js2MinSync: {
          options: {
            mangle: true,
            report: "gzip"
          },
          files: [
            {
              expand: true,
              cwd: js2MinSync,
              src: '{,**/}*.js',
              dest: destJs + '/js2MinSync',
              ext: '.js',
              flatten: false
            }
          ]
        },

        /* 多合一JS压缩 */
        js2MultSync: {
          options: {
            mangle: true
          },
          files: {
            'dest/js/js2MultSync/js2MultSync.min.js': [js2MultSync + '/{,**/}*.js']
          }
        }
      },
      clean: {
        folder: [destJs + '/js2MinSync'],
        folder_v2: ['path/to/dir/**'],
        contents: ['path/to/dir/*'],
        subfolders: ['path/to/dir/*/'],
        css: ['path/to/dir/*.css'],
        all_css: ['path/to/dir/**/*.css']
      },

      /* requireJs合并兼压缩 */
      requirejs: {
        srcJs: {
          options: {
            baseUrl: './',
            include: ['src/jsmin/1.js', 'src/jsmin/2.js'],
            uglify2: {
              output: {
                beautify: false
              },
              compress: {
                sequences: false,
                global_defs: {
                  DEBUG: false
                }
              },
              warnings: true,
              mangle: true
            },
            out: destJs + '/rj.js'
          }
        }
      },

      /* 9.Bower管理引入文件 */
      bower: {
        install: {
          options: {
            targetDir: bower,
            install: true,
            verbose: false,
            cleanTargetDir: true,
            cleanBowerDir: false,
            bowerOptions: {}
          }
        }
      },

      /* 10.转移开发文件到发布文件夹 */
      copy: {

        /* html、字体 */
        main: {
          files: [
            {
              expand: true,
              cwd: dirs.srcDir,
              src: ['*.html'],
              dest: dirs.destDir,
              flatten: true,
              filter: 'isFile'
            }
          ]
        }
      },

      /* 11.建立网站连接 */
      connect: {
        options: {
          open: {
            target: 'http://127.0.0.1:9080',
            appName: 'chrome',
            callback: function() {}
          },
          port: 9080,
          hostname: '127.0.0.1',
          livereload: 35729
        },
        server: {
          options: {
            open: true,
            base: ['./' + srcHtml]
          }
        }
      },

      /* 12.文件历史缓存 */
      newer: {
        options: {
          cache: 'newer/'
        }
      },

      /* 13.同步开发文件的删除添加重命名 */
      sync: {
        htmls: {
          files: [
            {
              cwd: srcHtml,
              src: ['{,**/}*.html'],
              dest: destHtml
            }
          ],
          pretend: false,
          verbose: true,
          updateAndDelete: true
        },
        imgs: {
          files: [
            {
              cwd: srcImg,
              src: ['**'],
              dest: destImg
            }
          ],
          pretend: false,
          verbose: true,
          updateAndDelete: true
        },
        fonts: {
          files: [
            {
              cwd: srcFonts,
              src: ['**'],
              dest: destFonts
            }
          ],
          pretend: false,
          verbose: true,
          updateAndDelete: true
        },
        css: {
          files: [
            {
              cwd: srcCss,
              src: ['{,**/}*.css'],
              dest: cssmin
            }
          ],
          pretend: false,
          verbose: true,
          updateAndDelete: true
        },
        scss: {
          files: [
            {
              cwd: scss,
              src: ['{,**/}*.css'],
              dest: scssmin
            }
          ],
          pretend: false,
          verbose: true,
          updateAndDelete: true
        },
        js2MinSync: {
          files: [
            {
              cwd: js2Min,
              src: ['{,**/}*.js', '!{,**/}*.coffee'],
              dest: js2MinSync
            }
          ],
          pretend: false,
          verbose: true,
          updateAndDelete: true
        },
        js2MultSync: {
          files: [
            {
              cwd: js2Mult,
              src: ['{,**/}*.js', '!{,**/}*.coffee'],
              dest: js2MultSync
            }
          ],
          pretend: false,
          verbose: true,
          updateAndDelete: true
        }
      },

      /* 14.监视变动 */
      watch: {
        options: {
          dateFormat: function(time) {
            grunt.log.writeln('监视耗时 ' + time + '毫秒' + (new Date()).toString());
            grunt.log.writeln('等待更多变化...');
          }

          /* 1.gruntfile自动重新加载 */
        },
        configFiles: {
          files: ['Gruntfile.js'],
          options: {
            reload: true
          }
        },

        /* 2.公共CSS */
        css: {
          files: [srcCss + '/{,**/}*.css'],
          tasks: ['newer:cssmin:css', 'sync:css']
        },

        /* 3.个人SCSS */
        scss: {
          files: [scss + '/{,**/}*.scss', scss + '/{,**/}*.css'],
          tasks: ['newer:sass:scss', 'newer:cssmin:scss', 'sync:scss', 'concat:scssCat']
        },

        /* 4.公共JS */

        /* 一一对应发布 */
        js2Min: {
          files: [js2Min + '/{,**/}*.{coffee,js}'],
          tasks: ['newer:coffee:js2Min', 'sync:js2MinSync', 'clean:folder', 'uglify:js2MinSync']
        },

        /* 5.个人JS以及coffeeJs */

        /* 多合一发布 */

        /* 编译coffeeJs，同步到cf2Mult文件夹，多合一压缩到发布目录 */
        js2Mult: {
          files: [js2Mult + '/{,**/}*.{coffee,js}'],
          tasks: ['newer:coffee:js2Mult', 'sync:js2MultSync', 'newer:uglify:js2MultSync']
        },

        /* 6.图片压缩 */
        imgmin: {
          files: [srcImg + '/{,**/}*'],
          tasks: ['newer:imagemin', 'sync:imgs']
        },
        htmlmin: {
          files: [srcHtml + '/{,**/}*'],
          tasks: ['newer:htmlmin', 'sync:htmls']
        },

        /* 7.格式文件 */
        fonts: {
          files: [srcFonts + '/{,**/}*'],
          tasks: ['sync:fonts']
        },

        /* 8.实时修改 */
        livereload: {
          options: {
            livereload: '<%=connect.options.livereload%>'
          },
          files: ['./' + srcHtml + '/{,**/}*.html', './' + srcCss + '/{,**/}*.css', './' + js2Min + '/{,**/}*.js', './' + js2Mult + '/{,**/}*.js', './' + srcImg + '/{,**/}*.{png,jpg}']
        }
      }
    });
    require('load-grunt-tasks')(grunt, {
      pattern: ['grunt-*', '@*/grunt-*']
    });

    /* 自定义requireJS任务 */
    grunt.registerTask('reqJs', 'requireJS', function(arg1) {
      var options, platformCfg, requireTask, taskCfg, tasks;
      taskCfg = grunt.file.readJSON('rjsGrunt.json');
      requireTask = taskCfg.requirejs;
      options = requireTask.main.options;
      if (arguments.length === 0) {
        platformCfg = options.web;
      } else {
        platformCfg = options.arg1;
      }
      options.include = platformCfg.include;
      options.name = platformCfg.name;
      options.out = platformCfg.out;
      options.paths = options.paths;
      options.mainConfigFile = options.mainConfigFile;
      grunt.config.set('requirejs', requireTask);
      tasks = ['requirejs'];
      return grunt.task.run(tasks);
    });

    /* 所有 */
    grunt.registerTask('all', ['newer:sass', 'newer:cssmin', 'newer:coffee', 'newer:uglify', 'newer:concat', 'newer:copy', 'connect', 'watch']);

    /* JS */
    grunt.registerTask('jsss', ['newer:coffee', 'newer:uglify', 'watch:js2Mult']);

    /* CSS */
    grunt.registerTask('csss', ['newer:sass', 'newer:cssmin', 'watch']);

    /* 检查格式 */
    grunt.registerTask('chkCSS', ['csslint']);
    grunt.registerTask('chkJS', ['jshint']);

    /* 实时修改 */
    grunt.registerTask('live', ['connect', 'watch']);

    /* 文件压缩 */
    grunt.registerTask('minify', ['imagemin', 'cssmin', 'uglify', 'htmlmin']);

    /* 文件合并 */
    grunt.registerTask('cat', ['concat']);
  };

}).call(this);

//# sourceMappingURL=Gruntfile.js.map
